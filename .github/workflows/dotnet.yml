# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: .NET

on:
  push:
    tags: ["v*"]

jobs:
  build:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 10.0.x
    - name: Restore dependencies
      run: dotnet restore
    - name: Build
      run: dotnet build --no-restore
    - name: Test
      run: dotnet test --no-build --verbosity normal
    - name: Publish Windows application
      run: |
        dotnet publish ${{ env.PROJECT_PATH }} `
        --configuration Release `
        --output publish `
        --runtime win-x64 `
        --self-contained true `
        -p:PublishSingleFile=false
    - name: Create ZIP package
      run: Compress-Archive -Path publish/* -DestinationPath "TT ${{ github.ref_name }} Windows x64.zip" -Force
    - name: Create Release with Ordered Languages
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ github.ref_name }}
        name: Release ${{ github.ref_name }}
        body: |
          ## 繁體中文 (zh-TW)
          
          ### 系統需求
          - **作業系統**: Windows 10/11 或 Windows Server 2016+
          - **架構**: 64 位元 (x64)
          - **儲存空間**: 至少 78MB 可用空間
          
          ### 安裝說明
          1. 下載 ZIP 壓縮檔
          2. 解壓縮到您喜歡的資料夾
          3. 執行應用程式主檔案
          4. 開始使用應用程式
            
          ### 注意事項
          - 此為自包含版本，無需安裝 .NET 運行時
          - 建議關閉防毒軟體暫時性排除掃描
          - 如有問題請聯繫技術支援
            
          ---
            
          ## 香港繁體 (yue-Hant-HK)
          
          
          ### 系統要求
          - **操作系統**: Windows 10/11 或 Windows Server 2016+
          - **架構**: 64 位元 (x64)
          - **儲存空間**: 至少 78MB 可用空間
            
          ### 安裝指引
          1. 下載 ZIP 壓縮檔
          2. 解壓縮到你想放嘅文件夾
          3. 執行應用程式主檔案
          4. 開始使用應用程式
            
          ### 注意事項
          - 呢個係自包含版本，唔需要安裝 .NET 運行時
          - 建議暫時關閉防毒軟體進行掃描排除
          - 如果有問題請聯繫技術支援
            
          ---
            
          ## English
              
          ### System Requirements
          - **OS**: Windows 10/11 or Windows Server 2016+
          - **Architecture**: 64-bit (x64)
          - **Storage**: At least 78MB free space
            
          ### Installation Guide
          1. Download the ZIP archive
          2. Extract to your preferred folder
          3. Run the main application executable
          4. Start using the application
            
          ### Important Notes
          - This is a self-contained version, no .NET runtime required
          - Temporarily disable antivirus for installation if needed
          - Contact technical support if you encounter any issues
        draft: false
        files: "publish/TT ${{ github.ref_name }} Windows x64.zip"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

